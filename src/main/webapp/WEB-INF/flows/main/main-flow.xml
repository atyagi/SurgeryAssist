<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
		http://www.springframework.org/schema/webflow
		http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">
	
	<!-- This is the flow for the home page. -->
	<!-- Decide which page to go to based on whether the user is an ASC or a surgeon -->
	<action-state id="decideSurgeonOrASC">
		<evaluate expression="homepageService.isUserSurgeonOrASC()" />
		<transition on="SURGEON" to="surgeonHome" />
		<transition on="ASC" to="ascHome" />
	</action-state>
	
	<!-- ASC's home page  -->
	<view-state id="ascHome">
		<transition on="inputAvailability" to="inputAvailabilityFlow" />	
	</view-state>
	
	<!-- Surgeon's home page -->
	<view-state id="surgeonHome">
		<on-entry>
			<evaluate expression="homepageService.getPendingBookings()" 
				result="flowScope.pendingBookings"/>
			<evaluate expression="homepageService.getConfirmedBookings()" 
				result="flowScope.confirmedBookings"/>
		</on-entry>
		<transition on="goToSearch" to="searchFlow" />
	</view-state>
	
	<!-- subflow for search -->
	<subflow-state id="searchFlow" subflow="search">
		<transition on="finish" to="decideSurgeonOrASC" />
	</subflow-state>
	
	<!-- subflow for registration -->
	<subflow-state id="registrationFlow" subflow="registration">
		<transition on="cancel" to="login" />
	</subflow-state>
	
	<!-- subflow for inputting availabilities -->
	<subflow-state id="inputAvailabilityFlow" subflow="inputAvailability">
		<transition on="finish" to="decideSurgeonOrASC" />
	</subflow-state>
	
</flow>